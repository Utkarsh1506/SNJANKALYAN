<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Member Dashboard - SNJ Ankalyan</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        @import url("https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800|Yeseva+One&display=swap");
        
        body {
            font-family: "Open Sans", sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
        }
        .dashboard-header {
            background: linear-gradient(90deg, #24c0f1 0%, #4c9afe 100%);
            color: white;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(36, 192, 241, 0.3);
        }
        .dashboard-header h1 {
            margin: 0;
            font-size: 28px;
            font-family: "Yeseva One", cursive;
        }
        .dashboard-header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
        }
        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 10px 25px;
            border: 2px solid white;
            border-radius: 50px;
            cursor: pointer;
            float: right;
            text-decoration: none;
            transition: all 0.3s;
            font-weight: 600;
        }
        .logout-btn:hover {
            background: white;
            color: #24c0f1;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        .status-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .status-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        .status-card .icon {
            font-size: 40px;
            margin-bottom: 10px;
        }
        .status-card .label {
            color: #7F8C8D;
            font-size: 14px;
            margin-bottom: 5px;
        }
        .status-card .value {
            font-size: 20px;
            font-weight: bold;
            color: #191d34;
            font-family: "Yeseva One", cursive;
        }
        .status-pending {
            color: #F39C12;
        }
        .status-approved {
            color: #10d876;
        }
        .status-rejected {
            color: #E74C3C;
        }
        .section {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section h2 {
            color: #191d34;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ECF0F1;
            font-family: "Yeseva One", cursive;
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        .info-item {
            padding: 15px;
            background: #F8F9FA;
            border-radius: 5px;
        }
        .info-item .label {
            font-size: 12px;
            color: #7F8C8D;
            margin-bottom: 5px;
        }
        .info-item .value {
            font-size: 16px;
            font-weight: 600;
            color: #191d34;
        }
        #idCardCanvas {
            width: 100%;
            max-width: 800px;
            height: auto;
            border: 2px solid #ECF0F1;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: block;
            margin: 20px auto;
        }
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }
        .btn-primary {
            background: linear-gradient(90deg, #24c0f1 0%, #4c9afe 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(36, 192, 241, 0.3);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(36, 192, 241, 0.4);
        }
        .btn-success {
            background: linear-gradient(90deg, #10d876 0%, #0fb562 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(16, 216, 118, 0.3);
        }
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 216, 118, 0.4);
        }
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .alert-warning {
            background: #FFF3CD;
            color: #856404;
            border: 1px solid #FFEAA7;
        }
        .alert-info {
            background: #D1ECF1;
            color: #0C5460;
            border: 1px solid #BEE5EB;
        }
        .payment-screenshot {
            max-width: 200px;
            border: 2px solid #ECF0F1;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .payment-screenshot:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div class="dashboard-header">
        <div class="container">
            <a href="#" class="logout-btn" onclick="logout()">üö™ Logout</a>
            <h1>üë§ Member Dashboard</h1>
            <p id="welcomeMessage">Welcome back!</p>
        </div>
    </div>

    <div class="container">
        <!-- Status Cards -->
        <div class="status-cards">
            <div class="status-card">
                <div class="icon">üìù</div>
                <div class="label">Application Status</div>
                <div class="value" id="applicationStatus">Loading...</div>
            </div>
            <div class="status-card">
                <div class="icon">üí≥</div>
                <div class="label">Payment Status</div>
                <div class="value" id="paymentStatus">Loading...</div>
            </div>
            <div class="status-card">
                <div class="icon">üé´</div>
                <div class="label">ID Card Status</div>
                <div class="value" id="idCardStatus">Loading...</div>
            </div>
        </div>

        <!-- Alerts -->
        <div id="alertContainer"></div>

        <!-- Personal Information -->
        <div class="section">
            <h2>üìã Personal Information</h2>
            <div class="info-grid" id="personalInfo">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>

        <!-- Payment Information -->
        <div class="section" id="paymentSection">
            <h2>üí∞ Payment Information</h2>
            <div class="info-grid" id="paymentInfo">
                <!-- Will be populated by JavaScript -->
            </div>
            <div style="margin-top: 20px;" id="screenshotContainer"></div>
        </div>

        <!-- ID Card Section -->
        <div class="section" id="idCardSection" style="display: none;">
            <h2>üé´ Your ID Card</h2>
            <canvas id="idCardCanvas"></canvas>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-success" onclick="downloadIDCard()">
                    üì• Download ID Card
                </button>
            </div>
        </div>
    </div>

    <script src="js/member-system.js"></script>
    <script src="js/auth-system.js"></script>
    <script src="js/idcard-generator.js"></script>
    <script>
        let currentMember = null;
        let idCardGen = null;

        // Get User ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get('userId');

        if (!userId) {
            window.location.href = 'member-login.html';
        }

        // Load member data
        function loadMemberData() {
            const result = memberSystem.getMemberByUserId(userId);

            if (!result.success) {
                alert('Member not found');
                window.location.href = 'member-login.html';
                return;
            }

            currentMember = result.member;

            // Update welcome message
            document.getElementById('welcomeMessage').textContent = 
                `Welcome, ${currentMember.name}! (${currentMember.userId})`;

            // Update status cards
            updateStatusCards();

            // Display personal information
            displayPersonalInfo();

            // Display payment information
            displayPaymentInfo();

            // Show ID card if approved
            if (result.status === 'approved') {
                generateIDCard();
            }
        }

        function updateStatusCards() {
            const appStatus = document.getElementById('applicationStatus');
            const payStatus = document.getElementById('paymentStatus');
            const idStatus = document.getElementById('idCardStatus');

            // Application Status
            if (currentMember.status === 'pending') {
                appStatus.textContent = '‚è≥ Pending';
                appStatus.className = 'value status-pending';
            } else if (currentMember.status === 'approved') {
                appStatus.textContent = '‚úÖ Approved';
                appStatus.className = 'value status-approved';
            } else {
                appStatus.textContent = '‚ùå Rejected';
                appStatus.className = 'value status-rejected';
            }

            // Payment Status
            if (currentMember.paymentVerified) {
                payStatus.textContent = '‚úÖ Verified';
                payStatus.className = 'value status-approved';
            } else if (currentMember.paymentStatus === 'rejected') {
                payStatus.textContent = '‚ùå Rejected';
                payStatus.className = 'value status-rejected';
            } else {
                payStatus.textContent = '‚è≥ Pending';
                payStatus.className = 'value status-pending';
            }

            // ID Card Status
            if (currentMember.status === 'approved') {
                idStatus.textContent = '‚úÖ Ready';
                idStatus.className = 'value status-approved';
            } else {
                idStatus.textContent = '‚è≥ Not Ready';
                idStatus.className = 'value status-pending';
            }

            // Show alerts
            showAlerts();
        }

        function showAlerts() {
            const alertContainer = document.getElementById('alertContainer');
            let alerts = '';

            if (currentMember.status === 'pending') {
                alerts += `
                    <div class="alert alert-warning">
                        ‚è≥ Your application is pending admin approval. 
                        You will be able to download your ID card once approved.
                    </div>
                `;
            }

            if (!currentMember.paymentVerified && currentMember.paymentStatus !== 'rejected') {
                alerts += `
                    <div class="alert alert-info">
                        üí≥ Your payment is being verified by admin. 
                        Please wait for confirmation.
                    </div>
                `;
            }

            alertContainer.innerHTML = alerts;
        }

        function displayPersonalInfo() {
            const container = document.getElementById('personalInfo');
            container.innerHTML = `
                <div class="info-item">
                    <div class="label">Full Name</div>
                    <div class="value">${currentMember.name}</div>
                </div>
                <div class="info-item">
                    <div class="label">User ID</div>
                    <div class="value">${currentMember.userId}</div>
                </div>
                <div class="info-item">
                    <div class="label">Date of Birth</div>
                    <div class="value">${formatDate(currentMember.dob)}</div>
                </div>
                <div class="info-item">
                    <div class="label">Gender</div>
                    <div class="value">${currentMember.gender}</div>
                </div>
                <div class="info-item">
                    <div class="label">Blood Group</div>
                    <div class="value">${currentMember.bloodGroup}</div>
                </div>
                <div class="info-item">
                    <div class="label">Mobile</div>
                    <div class="value">${currentMember.mobile}</div>
                </div>
                <div class="info-item">
                    <div class="label">Email</div>
                    <div class="value">${currentMember.email || 'N/A'}</div>
                </div>
                <div class="info-item">
                    <div class="label">Registration Date</div>
                    <div class="value">${formatDate(currentMember.registrationDate)}</div>
                </div>
            `;
        }

        function displayPaymentInfo() {
            const container = document.getElementById('paymentInfo');
            container.innerHTML = `
                <div class="info-item">
                    <div class="label">Amount Paid</div>
                    <div class="value">‚Çπ${currentMember.paymentAmount}</div>
                </div>
                <div class="info-item">
                    <div class="label">Transaction UTR</div>
                    <div class="value">${currentMember.paymentUTR}</div>
                </div>
                <div class="info-item">
                    <div class="label">Payment Date</div>
                    <div class="value">${formatDate(currentMember.paymentDate)}</div>
                </div>
                <div class="info-item">
                    <div class="label">Payment Status</div>
                    <div class="value ${currentMember.paymentVerified ? 'status-approved' : 'status-pending'}">
                        ${currentMember.paymentVerified ? '‚úÖ Verified' : '‚è≥ Pending Verification'}
                    </div>
                </div>
            `;

            // Show payment screenshot
            if (currentMember.paymentScreenshot) {
                document.getElementById('screenshotContainer').innerHTML = `
                    <h5>Payment Screenshot:</h5>
                    <img src="${currentMember.paymentScreenshot}" class="payment-screenshot" 
                         alt="Payment Screenshot" onclick="window.open(this.src)">
                    <p class="small text-muted">Click to view full size</p>
                `;
            }
        }

        async function generateIDCard() {
            try {
                document.getElementById('idCardSection').style.display = 'block';
                idCardGen = new IDCardGenerator('idCardCanvas');
                await idCardGen.generateIDCard(currentMember);
            } catch (error) {
                console.error('Error generating ID card:', error);
            }
        }

        function downloadIDCard() {
            if (idCardGen && currentMember) {
                const filename = `${currentMember.userId}_IDCard.png`;
                idCardGen.downloadIDCard(filename);
            }
        }

        function formatDate(dateStr) {
            if (!dateStr) return 'N/A';
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-IN', { 
                day: '2-digit', 
                month: 'short', 
                year: 'numeric' 
            });
        }

        function logout() {
            authSystem.logout();
            window.location.href = 'member-login.html';
        }

        // Load data on page load
        loadMemberData();
    </script>
</body>
</html>
