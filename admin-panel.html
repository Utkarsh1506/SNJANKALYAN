<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Member Approval</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        @import url("https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800|Yeseva+One&display=swap");
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: "Open Sans", sans-serif;
            background: #f8f9fa;
        }
        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px;
        }
        .admin-header {
            background: linear-gradient(90deg, #3cc78f 0%, #2cae79 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(60, 199, 143, 0.3);
        }
        .admin-header h1 {
            margin-bottom: 10px;
            font-family: "Yeseva One", cursive;
            font-size: 32px;
        }
        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 10px 25px;
            border: 2px solid white;
            border-radius: 50px;
            cursor: pointer;
            float: right;
            text-decoration: none;
            transition: all 0.3s;
            font-weight: 600;
        }
        .logout-btn:hover {
            background: white;
            color: #3cc78f;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
        .stat-card .icon {
            font-size: 40px;
            margin-bottom: 10px;
        }
        .stat-card .number {
            font-size: 36px;
            font-weight: bold;
            color: #191d34;
            margin-bottom: 5px;
            font-family: "Yeseva One", cursive;
        }
        .stat-card .label {
            color: #5c5c5c;
            font-size: 14px;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tab-btn {
            padding: 12px 30px;
            background: white;
            border: 2px solid #e8e8e8;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-family: "Open Sans", sans-serif;
        }
        .tab-btn.active {
            background: linear-gradient(90deg, #3cc78f 0%, #2cae79 100%);
            color: white;
            border-color: transparent;
            box-shadow: 0 5px 15px rgba(60, 199, 143, 0.3);
        }
        .tab-btn:hover:not(.active) {
            border-color: #3cc78f;
            color: #3cc78f;
            transform: translateY(-2px);
        }
        .members-section {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .search-bar {
            margin-bottom: 20px;
        }
        .search-bar input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ECF0F1;
            border-radius: 5px;
            font-size: 16px;
        }
        .member-card {
            background: #F8F9FA;
            border: 2px solid #ECF0F1;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }
        .member-card:hover {
            border-color: #3cc78f;
            box-shadow: 0 5px 20px rgba(60, 199, 143, 0.2);
        }
        .member-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ECF0F1;
        }
        .member-info {
            flex: 1;
        }
        .member-name {
            font-size: 20px;
            font-weight: bold;
            color: #191d34;
            margin-bottom: 5px;
            font-family: "Yeseva One", cursive;
        }
        .member-id {
            color: #7F8C8D;
            font-size: 14px;
        }
        .member-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        .detail-item {
            display: flex;
            flex-direction: column;
        }
        .detail-label {
            font-size: 12px;
            color: #7F8C8D;
            margin-bottom: 3px;
        }
        .detail-value {
            font-size: 14px;
            color: #191d34;
            font-weight: 600;
        }
        .member-photo {
            width: 100px;
            height: 100px;
            border-radius: 5px;
            object-fit: cover;
            border: 2px solid #ECF0F1;
        }
        .member-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        .btn {
            padding: 10px 25px;
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-approve {
            background: linear-gradient(90deg, #10d876 0%, #0fb562 100%);
            color: white;
            box-shadow: 0 3px 10px rgba(16, 216, 118, 0.3);
        }
        .btn-approve:hover {
            background: linear-gradient(90deg, #0fb562 0%, #0d9950 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 216, 118, 0.4);
        }
        .btn-reject {
            background: linear-gradient(90deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
            box-shadow: 0 3px 10px rgba(255, 107, 107, 0.3);
        }
        .btn-reject:hover {
            background: linear-gradient(90deg, #ee5a52 0%, #dc4d45 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }
        .btn-view {
            background: linear-gradient(90deg, #3cc78f 0%, #2cae79 100%);
            color: white;
            box-shadow: 0 3px 10px rgba(60, 199, 143, 0.3);
        }
        .btn-view:hover {
            background: linear-gradient(90deg, #36b583 0%, #2cae79 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(60, 199, 143, 0.4);
        }
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #7F8C8D;
        }
        .empty-state .icon {
            font-size: 60px;
            margin-bottom: 20px;
        }
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }
        .alert-success {
            background: #D4EDDA;
            color: #155724;
            border: 1px solid #C3E6CB;
        }
        .alert-error {
            background: #F8D7DA;
            color: #721C24;
            border: 1px solid #F5C6CB;
        }
        .utility-section {
            margin-top: 30px;
            display: flex;
            gap: 15px;
        }
        .btn-utility {
            background: #95A5A6;
            color: white;
        }
        .btn-utility:hover {
            background: #7F8C8D;
        }
        .content-tab-panel {
            min-height: 400px;
        }
        .form-control {
            width: 100%;
            padding: 10px;
            border: 2px solid #ECF0F1;
            border-radius: 5px;
            font-size: 14px;
            font-family: "Open Sans", sans-serif;
        }
        .form-control:focus {
            outline: none;
            border-color: #3cc78f;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Header -->
        <div class="admin-header">
            <a href="#" class="logout-btn" onclick="logout()">üö™ Logout</a>
            <h1>üõ°Ô∏è Admin Panel</h1>
            <p>Manage Member Applications and Approvals</p>
        </div>

        <!-- Statistics -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="icon">‚è≥</div>
                <div class="number" id="statPending">0</div>
                <div class="label">Pending Applications</div>
            </div>
            <div class="stat-card">
                <div class="icon">‚úÖ</div>
                <div class="number" id="statApproved">0</div>
                <div class="label">Approved Members</div>
            </div>
            <div class="stat-card">
                <div class="icon">üë•</div>
                <div class="number" id="statTotal">0</div>
                <div class="label">Total Registered</div>
            </div>
            <div class="stat-card" style="cursor: pointer;" onclick="showExportInfo()" title="Click for details">
                <div class="icon">üíæ</div>
                <div class="number" id="statBackup">Auto</div>
                <div class="label">Data Backup Status</div>
            </div>
        </div>

        <!-- Alert Box -->
        <div id="alertBox" class="alert"></div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('pending')">
                ‚è≥ Pending Applications
            </button>
            <button class="tab-btn" onclick="switchTab('approved')">
                ‚úÖ Approved Members
            </button>
            <button class="tab-btn" onclick="switchTab('donations')">
                üí∞ Donations
            </button>
            <button class="tab-btn" onclick="switchTab('messages')">
                üì• Messages
            </button>
            <button class="tab-btn" onclick="switchTab('content')">
                üìù Content Manager
            </button>
            <button class="tab-btn" onclick="switchTab('settings')">
                ‚öôÔ∏è Settings
            </button>
        </div>

        <!-- Members Section -->
        <div class="members-section" id="membersSection">
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="üîç Search by name, user ID, mobile..." 
                       onkeyup="searchMembers()">
            </div>

            <div id="membersContainer">
                <!-- Members will be loaded here -->
            </div>
        </div>

    <!-- Donations Section -->
        <div class="members-section" id="donationsSection" style="display: none;">
            <h3 style="margin-bottom: 25px; color: #2C3E50;">üí∞ Donations Overview</h3>
            
            <!-- Donation Statistics -->
            <div class="stats-container" style="margin-bottom: 30px;">
                <div class="stat-card">
                    <div class="icon">üíµ</div>
                    <div class="number" id="totalDonations">‚Çπ0</div>
                    <div class="label">Total Donations Received</div>
                </div>
                <div class="stat-card">
                    <div class="icon">‚úÖ</div>
                    <div class="number" id="verifiedDonations">‚Çπ0</div>
                    <div class="label">Verified Donations</div>
                </div>
                <div class="stat-card">
                    <div class="icon">‚è≥</div>
                    <div class="number" id="pendingDonations">‚Çπ0</div>
                    <div class="label">Pending Verification</div>
                </div>
                <div class="stat-card">
                    <div class="icon">üë•</div>
                    <div class="number" id="totalDonors">0</div>
                    <div class="label">Total Donors</div>
                </div>
            </div>

            <!-- Filter Options -->
            <div style="margin-bottom: 20px; display: flex; gap: 10px; align-items: center;">
                <label style="font-weight: 600; color: #2C3E50;">Filter:</label>
                <select id="donationFilter" onchange="loadDonations()" 
                        style="padding: 8px 15px; border: 2px solid #ECF0F1; border-radius: 5px; font-size: 14px;">
                    <option value="all">All Donations</option>
                    <option value="verified">Verified Only</option>
                    <option value="pending">Pending Only</option>
                </select>
                <input type="text" id="donationSearch" placeholder="üîç Search donor..." 
                       onkeyup="searchDonations()"
                       style="padding: 8px 15px; border: 2px solid #ECF0F1; border-radius: 5px; font-size: 14px; flex: 1;">
            </div>

            <!-- Donations List -->
            <div id="donationsContainer">
                <!-- Donations will be loaded here -->
            </div>
        </div>

        <!-- Messages Section -->
        <div class="members-section" id="messagesSection" style="display: none;">
            <h3 style="margin-bottom: 25px; color: #2C3E50;">üì• Inbox</h3>

            <div class="stats-container" style="margin-bottom: 20px;">
                <div class="stat-card">
                    <div class="icon">üÜò</div>
                    <div class="number" id="statProblems">0</div>
                    <div class="label">Problem Reports</div>
                </div>
                <div class="stat-card">
                    <div class="icon">‚úâÔ∏è</div>
                    <div class="number" id="statContacts">0</div>
                    <div class="label">Contact Messages</div>
                </div>
            </div>

            <!-- Messages Filters -->
            <div class="search-bar" style="display:flex; gap:10px; align-items:center;">
                <label style="font-weight:600; color:#2C3E50;">Type:</label>
                <select id="msgType" onchange="filterMessages()" 
                        style="padding:8px 12px; border:2px solid #ECF0F1; border-radius:5px;">
                    <option value="all">All</option>
                    <option value="problems">Problems</option>
                    <option value="contacts">Contacts</option>
                </select>
                <label style="font-weight:600; color:#2C3E50;">Status:</label>
                <select id="msgStatus" onchange="filterMessages()" 
                        style="padding:8px 12px; border:2px solid #ECF0F1; border-radius:5px;">
                    <option value="all">All Statuses</option>
                    <option value="pending">Pending</option>
                    <option value="in-progress">In-Progress</option>
                    <option value="resolved">Resolved</option>
                    <option value="new">New</option>
                    <option value="handled">Handled</option>
                </select>
                <input type="text" id="msgSearch" onkeyup="filterMessages()" placeholder="üîç Search name, subject, email, category" 
                       style="flex:1; padding:8px 12px; border:2px solid #ECF0F1; border-radius:5px;">
            </div>

            <div style="display: grid; grid-template-columns: 1fr; gap: 20px;">
                <div id="problemsBlock">
                    <h4 style="margin-bottom: 12px; color: #2C3E50;">üÜò Problem Reports</h4>
                    <div id="problemsContainer"></div>
                </div>
                <div id="contactsBlock">
                    <h4 style="margin-bottom: 12px; color: #2C3E50;">‚úâÔ∏è Contact Messages</h4>
                    <div id="contactsContainer"></div>
                </div>
            </div>
        </div>

        <!-- Content Manager Section -->
        <div class="members-section" id="contentSection" style="display: none;">
            <h3 style="margin-bottom: 25px; color: #2C3E50;">üìù Content Management</h3>

            <!-- Content Tabs -->
            <div class="tabs" style="margin-bottom: 20px;">
                <button class="tab-btn active" onclick="switchContentTab('certifications')">üìú Certifications</button>
                <button class="tab-btn" onclick="switchContentTab('team')">üë• Team</button>
                <button class="tab-btn" onclick="switchContentTab('gallery')">üñºÔ∏è Gallery</button>
                <button class="tab-btn" onclick="switchContentTab('donors')">üíù Donors</button>
                <button class="tab-btn" onclick="switchContentTab('news')">üì∞ News/Blog</button>
            </div>

            <!-- Certifications Management -->
            <div id="certificationsContent" class="content-tab-panel">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h4 style="color:#2C3E50;">Manage Certifications</h4>
                    <button class="btn btn-view" onclick="openCertModal()">‚ûï Add Certificate</button>
                </div>
                <div id="certificationsContainer"></div>
            </div>

            <!-- Team Management -->
            <div id="teamContent" class="content-tab-panel" style="display:none;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h4 style="color:#2C3E50;">Manage Team Members</h4>
                    <button class="btn btn-view" onclick="openTeamModal()">‚ûï Add Team Member</button>
                </div>
                <div id="teamContainer"></div>
            </div>

            <!-- Gallery Management -->
            <div id="galleryContent" class="content-tab-panel" style="display:none;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h4 style="color:#2C3E50;">Manage Gallery</h4>
                    <button class="btn btn-view" onclick="openGalleryModal()">‚ûï Add Image</button>
                </div>
                <div id="galleryContainer"></div>
            </div>

            <!-- Donors Management -->
            <div id="donorsContent" class="content-tab-panel" style="display:none;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h4 style="color:#2C3E50;">Manage Donors</h4>
                    <button class="btn btn-view" onclick="openDonorModal()">‚ûï Add Donor</button>
                </div>
                <div id="donorsContainer"></div>
            </div>

            <!-- News/Blog Management -->
            <div id="newsContent" class="content-tab-panel" style="display:none;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h4 style="color:#2C3E50;">Manage News/Blog Posts</h4>
                    <button class="btn btn-view" onclick="openNewsModal()">‚ûï Add News Post</button>
                </div>
                <div id="newsContainer"></div>
            </div>
        </div>

        <!-- Settings Section -->
        <div class="members-section" id="settingsSection" style="display: none;">
            <h3 style="margin-bottom: 20px; color: #2C3E50;">‚öôÔ∏è Admin Settings</h3>
            
            <!-- Change Password Card -->
            <div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 600px;">
                <h4 style="margin-bottom: 20px; color: #2C3E50;">üîê Change Password</h4>
                
                <div id="passwordAlertBox" class="alert" style="display: none; margin-bottom: 20px;"></div>
                
                <form id="changePasswordForm" style="margin-bottom: 0;">
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #2C3E50;">
                            Current Password
                        </label>
                        <input type="password" id="currentPassword" class="form-control" 
                               style="width: 100%; padding: 12px; border: 2px solid #ECF0F1; border-radius: 5px; font-size: 16px;"
                               placeholder="Enter current password" required>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #2C3E50;">
                            New Password
                        </label>
                        <input type="password" id="newPassword" class="form-control" 
                               style="width: 100%; padding: 12px; border: 2px solid #ECF0F1; border-radius: 5px; font-size: 16px;"
                               placeholder="Enter new password" required minlength="6">
                        <small style="color: #7F8C8D; font-size: 12px;">Minimum 6 characters</small>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #2C3E50;">
                            Confirm New Password
                        </label>
                        <input type="password" id="confirmPassword" class="form-control" 
                               style="width: 100%; padding: 12px; border: 2px solid #ECF0F1; border-radius: 5px; font-size: 16px;"
                               placeholder="Confirm new password" required>
                    </div>
                    
            <button type="submit" class="btn" 
                style="background: #3cc78f; color: white; padding: 12px 30px; border: none; border-radius: 5px; font-weight: 600; cursor: pointer; font-size: 16px;">
                        üîÑ Change Password
                    </button>
                </form>
            </div>
            
            <!-- Current Admin Info -->
            <div style="background: #F8F9FA; padding: 20px; border-radius: 10px; margin-top: 20px; max-width: 600px;">
                <h5 style="margin-bottom: 15px; color: #2C3E50;">üë§ Current Admin Information</h5>
                <p style="margin: 5px 0; color: #2C3E50;"><strong>Username:</strong> <span id="adminUsername">admin</span></p>
                <p style="margin: 5px 0; color: #2C3E50;"><strong>Email:</strong> <span id="adminEmail">Loading...</span></p>
            </div>

            <!-- Auto-Backup Information -->
            <div style="background: #E8F4F8; padding: 20px; border-radius: 10px; margin-top: 20px; max-width: 600px; border-left: 4px solid #3cc78f;">
                <h5 style="margin-bottom: 15px; color: #191d34;">üíæ Automatic Backup System</h5>
                <p style="margin: 8px 0; color: #191d34; line-height: 1.6;">
                    <strong>Status:</strong> <span style="color: #10d876;">‚úÖ Active</span>
                </p>
                <p style="margin: 8px 0; color: #5c5c5c; line-height: 1.6;">
                    ‚Ä¢ Automatic backups run every 24 hours<br>
                    ‚Ä¢ Data is exported as JSON files<br>
                    ‚Ä¢ Backups are downloaded to your device<br>
                    ‚Ä¢ Perfect for GitHub Pages hosting
                </p>
                <div id="backupStatus" style="margin-top: 15px; padding: 12px; background: white; border-radius: 5px;">
                    <small style="color: #7F8C8D;">Loading backup status...</small>
                </div>
        <button class="btn" onclick="triggerManualBackup()" 
            style="background: linear-gradient(90deg, #3cc78f 0%, #2cae79 100%); color: white; padding: 10px 20px; margin-top: 15px; border-radius: 50px;">
                    üíæ Create Backup Now
                </button>
            </div>

            <!-- Email Delivery (EmailJS) Settings -->
            <div style="background: #F8F9FA; padding: 20px; border-radius: 10px; margin-top: 20px; max-width: 700px;">
                <h5 style="margin-bottom: 15px; color: #2C3E50;">üìß Email Delivery (EmailJS)</h5>
                <p style="color:#5c5c5c; margin-top:-8px;">Configure EmailJS to send emails automatically without opening a mail app. Create a free EmailJS account to get your Service ID, Template ID and Public Key.</p>

                <div style="display:grid; grid-template-columns: repeat(auto-fit,minmax(240px,1fr)); gap:12px; margin-top:12px;">
                    <label style="display:block; font-weight:600; color:#2C3E50;">
                        <input type="checkbox" id="emailjsEnabled" style="margin-right:8px;"> Enable EmailJS
                    </label>
                    <div>
                        <label style="display:block; font-weight:600; color:#2C3E50;">Service ID</label>
                        <input id="emailjsService" class="form-control" style="border:2px solid #ECF0F1;" placeholder="e.g. service_xxx">
                    </div>
                    <div>
                        <label style="display:block; font-weight:600; color:#2C3E50;">Template ID</label>
                        <input id="emailjsTemplate" class="form-control" style="border:2px solid #ECF0F1;" placeholder="e.g. template_xxx">
                    </div>
                    <div>
                        <label style="display:block; font-weight:600; color:#2C3E50;">Public Key</label>
                        <input id="emailjsPublicKey" class="form-control" style="border:2px solid #ECF0F1;" placeholder="e.g. XXXXXX">
                    </div>
                </div>

                <div style="margin-top:12px; display:flex; gap:10px;">
                    <button class="btn" style="background:#3cc78f; color:white; padding:10px 20px;" onclick="saveEmailConfig()">üíæ Save</button>
                    <button class="btn" style="background:#3498DB; color:white; padding:10px 20px;" onclick="testEmailConfig()">‚úâÔ∏è Send Test Email</button>
                </div>
                <small style="display:block; margin-top:8px; color:#7F8C8D;">Templates should accept variables: to_email, subject, message</small>
            </div>
        </div>

        <!-- Utility Buttons -->
        <div class="utility-section">
            <button class="btn btn-utility" onclick="exportData()">
                üì• Export Data
            </button>
            <button class="btn btn-utility" onclick="showImportDialog()">
                üì§ Import Data
            </button>
            <button class="btn btn-utility" onclick="triggerManualBackup()" style="background: #3cc78f;">
                üíæ Manual Backup
            </button>
            <button class="btn btn-utility" onclick="clearAllData()" style="background: #E74C3C;">
                üóëÔ∏è Clear All Data
            </button>
            <button class="btn btn-utility" onclick="window.location.href='index.html'">
                üè† Back to Home
            </button>
        </div>
    </div>

    <!-- Modals for Content Management -->
    <div id="contentModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:10000; overflow-y:auto;">
        <div style="max-width:600px; margin:50px auto; background:white; border-radius:10px; padding:30px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h3 id="modalTitle" style="color:#2C3E50; margin:0;"></h3>
                <button onclick="closeContentModal()" style="background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
            </div>
            <form id="contentForm" onsubmit="submitContentForm(event)">
                <div id="modalFormContent"></div>
                <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:20px;">
                    <button type="button" class="btn" style="background:#95A5A6; color:white;" onclick="closeContentModal()">Cancel</button>
                    <button type="submit" class="btn btn-view">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script src="js/member-system.js"></script>
    <script src="js/auth-system.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/admin-content-manager.js"></script>
    <script>
        // Check authentication
        if (!authSystem.isAdminLoggedIn()) {
            window.location.href = 'admin-login.html';
        }

        let currentTab = 'pending';
    let allMembers = [];
    let allDonations = [];
    let _rawProblems = [];
    let _rawContacts = [];

        // Initialize admin panel
        function init() {
            loadStatistics();
            loadMembers();
        }

        // Load statistics
        function loadStatistics() {
            const pending = memberSystem.getPendingMembers();
            const approved = memberSystem.getApprovedMembers();

            document.getElementById('statPending').textContent = pending.length;
            document.getElementById('statApproved').textContent = approved.length;
            document.getElementById('statTotal').textContent = pending.length + approved.length;
        }

        // Switch between tabs
        function switchTab(tab) {
            currentTab = tab;
            
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Show/hide sections
            const membersSection = document.getElementById('membersSection');
            const donationsSection = document.getElementById('donationsSection');
            const messagesSection = document.getElementById('messagesSection');
            const contentSection = document.getElementById('contentSection');
            const settingsSection = document.getElementById('settingsSection');

            // Hide all sections first
            membersSection.style.display = 'none';
            donationsSection.style.display = 'none';
            messagesSection.style.display = 'none';
            contentSection.style.display = 'none';
            settingsSection.style.display = 'none';

            // Show the selected section
            if (tab === 'settings') {
                settingsSection.style.display = 'block';
                loadAdminInfo();
            } else if (tab === 'content') {
                contentSection.style.display = 'block';
                loadContentManagement();
            } else if (tab === 'messages') {
                messagesSection.style.display = 'block';
                loadMessages();
            } else if (tab === 'donations') {
                donationsSection.style.display = 'block';
                loadDonations();
            } else {
                membersSection.style.display = 'block';
                loadMembers();
            }
        }

        // Load messages (problems + contacts)
        function loadMessages() {
            _rawProblems = JSON.parse(localStorage.getItem('charity_problems') || '[]');
            _rawContacts = JSON.parse(localStorage.getItem('charity_contacts') || '[]');

            // Update raw totals (not affected by filters)
            document.getElementById('statProblems').textContent = _rawProblems.length;
            document.getElementById('statContacts').textContent = _rawContacts.length;

            // Apply any existing filters/search
            filterMessages();
        }

        function displayProblems(list) {
            const container = document.getElementById('problemsContainer');
            if (!list.length) {
                container.innerHTML = `<div class="empty-state"><div class="icon">üì≠</div><h3>No problem reports</h3><p>New reports will appear here.</p></div>`;
                return;
            }
            container.innerHTML = list.map((p, idx) => `
                <div class="member-card">
                    <div class="member-header">
                        <div class="member-info">
                            <div class="member-name">${p.title}</div>
                            <div class="member-id">${p.category?.toUpperCase() || 'GENERAL'} ‚Ä¢ ${new Date(p.submittedDate).toLocaleString()}</div>
                        </div>
                        <div>
                            <span class="detail-value" style="color:${p.status==='resolved' ? '#27AE60' : p.status==='in-progress' ? '#F39C12' : '#7F8C8D'}">${p.status || 'pending'}</span>
                        </div>
                    </div>
                    <div class="member-details">
                        <div class="detail-item"><span class="detail-label">Name</span><span class="detail-value">${p.name}</span></div>
                        <div class="detail-item"><span class="detail-label">Mobile</span><span class="detail-value">${p.mobile}</span></div>
                        <div class="detail-item"><span class="detail-label">Email</span><span class="detail-value">${p.email || 'N/A'}</span></div>
                        <div class="detail-item" style="grid-column: 1 / -1;">
                            <span class="detail-label">Description</span>
                            <span class="detail-value">${p.description}</span>
                        </div>
                        ${p.address ? `<div class="detail-item" style="grid-column: 1 / -1;"><span class="detail-label">Address</span><span class="detail-value">${p.address}</span></div>` : ''}
                    </div>
                    <div class="member-actions">
                        <button class="btn btn-view" onclick="updateProblemStatus(${idx}, 'in-progress')">‚è≥ In-Progress</button>
                        <button class="btn btn-approve" onclick="updateProblemStatus(${idx}, 'resolved')">‚úÖ Resolved</button>
                    </div>
                </div>
            `).join('');
        }

        function displayContacts(list) {
            const container = document.getElementById('contactsContainer');
            if (!list.length) {
                container.innerHTML = `<div class="empty-state"><div class="icon">üì≠</div><h3>No contact messages</h3><p>Messages submitted via Contact form will show up here.</p></div>`;
                return;
            }
            container.innerHTML = list.map((c, idx) => `
                <div class="member-card">
                    <div class="member-header">
                        <div class="member-info">
                            <div class="member-name">${c.subject}</div>
                            <div class="member-id">From ${c.name} ‚Ä¢ ${new Date(c.submittedDate).toLocaleString()}</div>
                        </div>
                        <div>
                            <span class="detail-value" style="color:${c.status==='handled' ? '#27AE60' : '#7F8C8D'}">${c.status || 'new'}</span>
                        </div>
                    </div>
                    <div class="member-details">
                        <div class="detail-item"><span class="detail-label">Email</span><span class="detail-value">${c.email}</span></div>
                        <div class="detail-item" style="grid-column: 1 / -1;">
                            <span class="detail-label">Message</span>
                            <span class="detail-value">${c.message}</span>
                        </div>
                    </div>
                    <div class="member-actions">
                        <button class="btn btn-view" onclick="markContactHandled(${idx})">‚úÖ Mark Handled</button>
                    </div>
                </div>
            `).join('');
        }

        // Filter/search for Messages tab
        function filterMessages() {
            const type = (document.getElementById('msgType')?.value || 'all').toLowerCase();
            const status = (document.getElementById('msgStatus')?.value || 'all').toLowerCase();
            const q = (document.getElementById('msgSearch')?.value || '').toLowerCase().trim();

            // Visibility by type
            const problemsBlock = document.getElementById('problemsBlock');
            const contactsBlock = document.getElementById('contactsBlock');
            if (problemsBlock && contactsBlock) {
                problemsBlock.style.display = (type === 'all' || type === 'problems') ? 'block' : 'none';
                contactsBlock.style.display = (type === 'all' || type === 'contacts') ? 'block' : 'none';
            }

            // Problems filter
            let problems = _rawProblems.slice();
            if (status !== 'all') {
                problems = problems.filter(p => {
                    const st = (p.status || 'pending').toLowerCase();
                    return st === status;
                });
            }
            if (q) {
                problems = problems.filter(p =>
                    (p.title || '').toLowerCase().includes(q) ||
                    (p.category || '').toLowerCase().includes(q) ||
                    (p.name || '').toLowerCase().includes(q) ||
                    (p.email || '').toLowerCase().includes(q) ||
                    (p.mobile || '').toLowerCase().includes(q) ||
                    (p.description || '').toLowerCase().includes(q)
                );
            }

            // Contacts filter
            let contacts = _rawContacts.slice();
            if (status !== 'all') {
                contacts = contacts.filter(c => {
                    const st = (c.status || 'new').toLowerCase();
                    return st === status;
                });
            }
            if (q) {
                contacts = contacts.filter(c =>
                    (c.subject || '').toLowerCase().includes(q) ||
                    (c.name || '').toLowerCase().includes(q) ||
                    (c.email || '').toLowerCase().includes(q) ||
                    (c.message || '').toLowerCase().includes(q)
                );
            }

            // Render
            displayProblems(problems);
            displayContacts(contacts);
        }

        // Update statuses and persist
        function updateProblemStatus(index, status) {
            const list = JSON.parse(localStorage.getItem('charity_problems') || '[]');
            if (!list[index]) return;
            list[index].status = status;
            localStorage.setItem('charity_problems', JSON.stringify(list));
            loadMessages();
            showAlert('success', `üìù Problem marked as ${status}.`);
        }

        function markContactHandled(index) {
            const list = JSON.parse(localStorage.getItem('charity_contacts') || '[]');
            if (!list[index]) return;
            list[index].status = 'handled';
            localStorage.setItem('charity_contacts', JSON.stringify(list));
            loadMessages();
            showAlert('success', '‚úâÔ∏è Message marked as handled.');
        }

        // Load and display members
        function loadMembers() {
            if (currentTab === 'pending') {
                allMembers = memberSystem.getPendingMembers();
            } else {
                allMembers = memberSystem.getApprovedMembers();
            }

            displayMembers(allMembers);
        }

        // Display members
        function displayMembers(members) {
            const container = document.getElementById('membersContainer');

            if (members.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üì≠</div>
                        <h3>No ${currentTab} members found</h3>
                        <p>There are no ${currentTab} member applications at the moment.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = members.map(member => `
                <div class="member-card">
                    <div class="member-header">
                        <div style="display: flex; gap: 20px; align-items: center;">
                            ${member.photo ? 
                                `<img src="${member.photo}" alt="Photo" class="member-photo">` : 
                                '<div class="member-photo" style="display: flex; align-items: center; justify-content: center; background: #ECF0F1; font-size: 40px;">üë§</div>'
                            }
                            <div class="member-info">
                                <div class="member-name">${member.name}</div>
                                <div class="member-id">User ID: ${member.userId}</div>
                                <div class="member-id">Registered: ${formatDate(member.registrationDate)}</div>
                            </div>
                        </div>
                    </div>

                    <div class="member-details">
                        <div class="detail-item">
                            <span class="detail-label">S/O, D/O, W/O</span>
                            <span class="detail-value">${member.sonof}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Date of Birth</span>
                            <span class="detail-value">${formatDate(member.dob)}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Gender</span>
                            <span class="detail-value">${member.gender}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Blood Group</span>
                            <span class="detail-value">${member.bloodGroup}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Mobile</span>
                            <span class="detail-value">${member.mobile}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Email</span>
                            <span class="detail-value">${member.email || 'N/A'}</span>
                        </div>
                    </div>

                    <div class="detail-item" style="margin-bottom: 15px;">
                        <span class="detail-label">Address</span>
                        <span class="detail-value">${member.address}</span>
                    </div>

                    ${member.paymentAmount ? `
                    <div style="background: #F8F9FA; padding: 15px; border-radius: 5px; margin-bottom: 15px;">
                        <h6 style="margin-bottom: 10px; color: #2C3E50;">üí≥ Payment Information</h6>
                        <div class="detail-item" style="margin-bottom: 8px;">
                            <span class="detail-label">Amount:</span>
                            <span class="detail-value">‚Çπ${member.paymentAmount}</span>
                        </div>
                        <div class="detail-item" style="margin-bottom: 8px;">
                            <span class="detail-label">UTR:</span>
                            <span class="detail-value">${member.paymentUTR}</span>
                        </div>
                        <div class="detail-item" style="margin-bottom: 8px;">
                            <span class="detail-label">Status:</span>
                            <span class="detail-value" style="color: ${member.paymentVerified ? '#27AE60' : '#F39C12'}">
                                ${member.paymentVerified ? '‚úÖ Verified' : '‚è≥ Pending Verification'}
                            </span>
                        </div>
                        ${member.paymentScreenshot ? `
                        <div style="margin-top: 10px;">
                            <img src="${member.paymentScreenshot}" 
                                 style="max-width: 200px; border: 1px solid #ddd; border-radius: 5px; cursor: pointer;"
                                 onclick="window.open(this.src)"
                                 alt="Payment Screenshot">
                            <p style="font-size: 11px; color: #7F8C8D; margin: 5px 0 0 0;">Click to view full size</p>
                        </div>
                        ` : ''}
                        ${currentTab === 'pending' && !member.paymentVerified ? `
                        <div style="margin-top: 10px;">
                            <button class="btn" style="background: #27AE60; color: white; padding: 8px 20px; font-size: 14px;" 
                                    onclick="verifyPayment('${member.userId}', true)">
                                ‚úÖ Verify Payment
                            </button>
                            <button class="btn" style="background: #E74C3C; color: white; padding: 8px 20px; font-size: 14px;" 
                                    onclick="verifyPayment('${member.userId}', false)">
                                ‚ùå Reject Payment
                            </button>
                        </div>
                        ` : ''}
                    </div>
                    ` : ''}

                    <div class="member-actions">
                        ${currentTab === 'pending' ? `
                            <button class="btn btn-approve" onclick="approveMember('${member.userId}')">
                                ‚úÖ Approve
                            </button>
                            <button class="btn btn-reject" onclick="rejectMember('${member.userId}')">
                                ‚ùå Reject
                            </button>
                        ` : `
                            <button class="btn btn-view" onclick="viewMemberDetails('${member.userId}')">
                                üëÅÔ∏è View Details
                            </button>
                        `}
                    </div>
                </div>
            `).join('');
        }

        // Approve member
        function approveMember(userId) {
            if (confirm('Are you sure you want to approve this member?')) {
                const result = memberSystem.approveMember(userId);
                
                if (result.success) {
                    showAlert('success', `‚úÖ Member ${userId} has been approved successfully!`);
                    loadStatistics();
                    loadMembers();
                } else {
                    showAlert('error', `‚ùå Failed to approve member: ${result.error}`);
                }
            }
        }

        // Reject member
        function rejectMember(userId) {
            const reason = prompt('Please enter the reason for rejection (optional):');
            
            if (reason !== null) {
                const result = memberSystem.rejectMember(userId, reason);
                
                if (result.success) {
                    showAlert('success', `‚ùå Member ${userId} has been rejected.`);
                    loadStatistics();
                    loadMembers();
                } else {
                    showAlert('error', `‚ùå Failed to reject member: ${result.error}`);
                }
            }
        }

        // View member details
        function viewMemberDetails(userId) {
            const result = memberSystem.getMemberByUserId(userId);
            if (result.success) {
                alert(`Member Details:\n\n${JSON.stringify(result.member, null, 2)}`);
            }
        }

        // Search members
        function searchMembers() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            const filtered = allMembers.filter(member => 
                member.name.toLowerCase().includes(searchTerm) ||
                member.userId.toLowerCase().includes(searchTerm) ||
                member.mobile.includes(searchTerm) ||
                (member.email && member.email.toLowerCase().includes(searchTerm))
            );

            displayMembers(filtered);
        }

        // Export data
        function exportData() {
            const data = memberSystem.exportData();
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `member-data-${new Date().toISOString().split('T')[0]}.json`;
            link.click();

            showAlert('success', '‚úÖ Data exported successfully!');
        }

        // Show import dialog
        function showImportDialog() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const data = JSON.parse(event.target.result);
                        const result = memberSystem.importData(data);
                        
                        if (result.success) {
                            showAlert('success', '‚úÖ Data imported successfully!');
                            loadStatistics();
                            loadMembers();
                        } else {
                            showAlert('error', `‚ùå Import failed: ${result.error}`);
                        }
                    } catch (error) {
                        showAlert('error', '‚ùå Invalid JSON file!');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // Clear all data
        function clearAllData() {
            if (confirm('‚ö†Ô∏è WARNING: This will delete ALL member data. This action cannot be undone!\n\nAre you absolutely sure?')) {
                if (confirm('Last confirmation: Delete ALL data?')) {
                    memberSystem.clearAllData();
                    showAlert('success', '‚úÖ All data has been cleared.');
                    loadStatistics();
                    loadMembers();
                }
            }
        }

        // Show alert
        function showAlert(type, message) {
            const alertBox = document.getElementById('alertBox');
            alertBox.className = 'alert alert-' + type;
            alertBox.innerHTML = message;
            alertBox.style.display = 'block';

            setTimeout(() => {
                alertBox.style.display = 'none';
            }, 5000);
        }

        // Format date
        function formatDate(dateStr) {
            if (!dateStr) return 'N/A';
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-IN', { 
                day: '2-digit', 
                month: 'short', 
                year: 'numeric' 
            });
        }

        // Verify payment
        function verifyPayment(userId, verified) {
            const action = verified ? 'verify' : 'reject';
            if (confirm(`Are you sure you want to ${action} this payment?`)) {
                const result = memberSystem.verifyPayment(userId, verified);
                
                if (result.success) {
                    showAlert('success', `‚úÖ Payment ${verified ? 'verified' : 'rejected'} successfully!`);
                    loadStatistics();
                    loadMembers();
                } else {
                    showAlert('error', `‚ùå Failed to ${action} payment: ${result.error}`);
                }
            }
        }

        // Logout
        function logout() {
            authSystem.logout();
            window.location.href = 'admin-login.html';
        }

        // Load admin info
        function loadAdminInfo() {
            try {
                const adminData = JSON.parse(localStorage.getItem('charity_admin'));
                if (adminData) {
                    document.getElementById('adminUsername').textContent = adminData.username || 'admin';
                    document.getElementById('adminEmail').textContent = adminData.email || 'N/A';
                }
                // Populate EmailJS config
                loadEmailConfig();
                
                // Load backup status
                loadBackupStatus();
            } catch (error) {
                console.error('Error loading admin info:', error);
            }
        }

        // EmailJS settings helpers
        function loadEmailConfig() {
            try {
                const cfg = JSON.parse(localStorage.getItem('charity_emailjs') || '{}');
                document.getElementById('emailjsEnabled').checked = !!cfg.enabled;
                document.getElementById('emailjsService').value = cfg.serviceId || '';
                document.getElementById('emailjsTemplate').value = cfg.templateId || '';
                document.getElementById('emailjsPublicKey').value = cfg.publicKey || '';
            } catch (e) {
                // ignore
            }
        }

        function saveEmailConfig() {
            const enabled = document.getElementById('emailjsEnabled').checked;
            const serviceId = document.getElementById('emailjsService').value.trim();
            const templateId = document.getElementById('emailjsTemplate').value.trim();
            const publicKey = document.getElementById('emailjsPublicKey').value.trim();

            const config = { enabled, serviceId, templateId, publicKey };
            localStorage.setItem('charity_emailjs', JSON.stringify(config));

            // Best-effort init
            try {
                if (enabled && publicKey && window.emailjs && emailjs.init) {
                    emailjs.init(publicKey);
                }
            } catch {}

            showAlert('success', '‚úÖ Email settings saved.');
        }

        async function testEmailConfig() {
            const to = (function(){
                try { return (JSON.parse(localStorage.getItem('charity_admin'))||{}).email || ''; } catch { return ''; }
            })();
            if (!to) {
                showAlert('error', '‚ùå Please set an admin email first in Settings.');
                return;
            }
            const ts = new Date().toLocaleString();
            try {
                const result = await notifications.sendAdminEmail('Test Email from Admin Panel', `Hello,\n\nThis is a test email from SNJANKALYAN Admin Panel.\nTimestamp: ${ts}\n\nIf you received this, EmailJS (or your mail app) is wired correctly.`);
                if (result && result.success) {
                    showAlert('success', `‚úÖ Test email initiated via ${result.method.toUpperCase()}.`);
                } else {
                    showAlert('error', '‚ùå Test email failed to send.');
                }
            } catch (e) {
                showAlert('error', '‚ùå Test email failed. See console for details.');
                console.error(e);
            }
        }

        // Load backup status
        function loadBackupStatus() {
            try {
                const info = memberSystem.getLastExportInfo();
                const statusDiv = document.getElementById('backupStatus');
                
                if (info.success) {
                    statusDiv.innerHTML = `
                        <strong style="color: #191d34;">Last Backup:</strong> ${info.lastExport}<br>
                        <strong style="color: #191d34;">Next Backup:</strong> ${info.nextExport}<br>
                        <strong style="color: #191d34;">Status:</strong> 
                        <span style="color: #10d876;">Next backup in ${info.daysUntilNext} day(s)</span>
                    `;
                } else {
                    statusDiv.innerHTML = `
                        <strong style="color: #191d34;">Status:</strong> 
                        <span style="color: #F39C12;">No backups yet - first backup will be created automatically within 24 hours</span>
                    `;
                }
            } catch (error) {
                console.error('Error loading backup status:', error);
            }
        }

        // Handle password change
        document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            // Clear previous alerts
            const alertBox = document.getElementById('passwordAlertBox');
            alertBox.style.display = 'none';

            // Validation
            if (newPassword.length < 6) {
                showPasswordAlert('error', '‚ùå New password must be at least 6 characters long');
                return;
            }

            if (newPassword !== confirmPassword) {
                showPasswordAlert('error', '‚ùå New password and confirmation do not match');
                return;
            }

            if (currentPassword === newPassword) {
                showPasswordAlert('error', '‚ùå New password must be different from current password');
                return;
            }

            // Change password
            const result = authSystem.changeAdminPassword(currentPassword, newPassword);

            if (result.success) {
                showPasswordAlert('success', '‚úÖ Password changed successfully!');
                // Reset form
                document.getElementById('changePasswordForm').reset();
                
                // Show notification
                showAlert('success', '‚úÖ Admin password has been updated successfully!');
                
                // Auto logout after 3 seconds
                setTimeout(function() {
                    alert('Please login again with your new password.');
                    logout();
                }, 3000);
            } else {
                showPasswordAlert('error', '‚ùå ' + result.error);
            }
        });

        function showPasswordAlert(type, message) {
            const alertBox = document.getElementById('passwordAlertBox');
            alertBox.className = 'alert alert-' + type;
            alertBox.innerHTML = message;
            alertBox.style.display = 'block';

            // Scroll to alert
            alertBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Show export/backup information
        function showExportInfo() {
            const info = memberSystem.getLastExportInfo();
            
            if (info.success) {
                alert(`üìä Auto-Backup Status\n\n` +
                      `Last Backup: ${info.lastExport}\n` +
                      `Next Backup: ${info.nextExport}\n` +
                      `Days Until Next: ${info.daysUntilNext}\n\n` +
                      `üí° Backups are automatically downloaded every 24 hours.\n` +
                      `You can also create a manual backup anytime.`);
            } else {
                alert(`üìä Auto-Backup Status\n\n` +
                      `No backups created yet.\n\n` +
                      `üí° The first automatic backup will be created within 24 hours.\n` +
                      `You can create a manual backup now if needed.`);
            }
        }

        // Trigger manual backup
        function triggerManualBackup() {
            if (confirm('Create a manual backup now?\n\nThis will download a JSON file with all member data.')) {
                const success = memberSystem.triggerAutoExport();
                
                if (success) {
                    showAlert('success', '‚úÖ Manual backup created successfully!');
                } else {
                    showAlert('error', '‚ùå Backup creation failed. Please try again.');
                }
            }
        }

        // Load donations
        function loadDonations() {
            const pending = memberSystem.getPendingMembers();
            const approved = memberSystem.getApprovedMembers();
            
            // Combine all members with payment information
            const allMembersWithPayments = [...pending, ...approved].filter(m => m.paymentAmount);
            
            // Calculate statistics
            let totalAmount = 0;
            let verifiedAmount = 0;
            let pendingAmount = 0;
            
            allMembersWithPayments.forEach(member => {
                const amount = parseFloat(member.paymentAmount) || 0;
                totalAmount += amount;
                
                if (member.paymentVerified) {
                    verifiedAmount += amount;
                } else {
                    pendingAmount += amount;
                }
            });

            // Update statistics
            document.getElementById('totalDonations').textContent = `‚Çπ${totalAmount.toLocaleString('en-IN')}`;
            document.getElementById('verifiedDonations').textContent = `‚Çπ${verifiedAmount.toLocaleString('en-IN')}`;
            document.getElementById('pendingDonations').textContent = `‚Çπ${pendingAmount.toLocaleString('en-IN')}`;
            document.getElementById('totalDonors').textContent = allMembersWithPayments.length;

            // Store donations for filtering
            allDonations = allMembersWithPayments;

            // Display donations
            displayDonations(allDonations);
        }

        // Display donations
        function displayDonations(donations) {
            const filter = document.getElementById('donationFilter').value;
            
            // Apply filter
            let filtered = donations;
            if (filter === 'verified') {
                filtered = donations.filter(d => d.paymentVerified);
            } else if (filter === 'pending') {
                filtered = donations.filter(d => !d.paymentVerified);
            }

            const container = document.getElementById('donationsContainer');

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üí∞</div>
                        <h3>No donations found</h3>
                        <p>There are no donation records matching the selected filter.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filtered.map((member, index) => `
                <div class="member-card" style="background: ${member.paymentVerified ? '#E8F8F5' : '#FFF8E1'};">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                        <div style="flex: 1;">
                            <div style="font-size: 18px; font-weight: bold; color: #2C3E50; margin-bottom: 5px;">
                                ${index + 1}. ${member.name}
                            </div>
                            <div style="font-size: 13px; color: #7F8C8D;">
                                User ID: ${member.userId} | Mobile: ${member.mobile}
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 24px; font-weight: bold; color: #27AE60;">
                                ‚Çπ${parseFloat(member.paymentAmount).toLocaleString('en-IN')}
                            </div>
                            <div style="font-size: 12px; color: #7F8C8D;">
                                ${formatDate(member.registrationDate)}
                            </div>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; padding: 15px; background: white; border-radius: 5px;">
                        <div class="detail-item">
                            <span class="detail-label">Payment Status</span>
                            <span class="detail-value" style="color: ${member.paymentVerified ? '#27AE60' : '#F39C12'}">
                                ${member.paymentVerified ? '‚úÖ Verified' : '‚è≥ Pending Verification'}
                            </span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">UTR Number</span>
                            <span class="detail-value">${member.paymentUTR}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Member Status</span>
                            <span class="detail-value" style="color: ${member.approved ? '#27AE60' : '#F39C12'}">
                                ${member.approved ? '‚úÖ Approved' : '‚è≥ Pending Approval'}
                            </span>
                        </div>
                    </div>

                    ${member.paymentScreenshot ? `
                    <div style="margin-top: 15px; padding: 15px; background: white; border-radius: 5px;">
                        <div style="font-size: 14px; font-weight: 600; color: #2C3E50; margin-bottom: 10px;">
                            üì∑ Payment Screenshot
                        </div>
                        <img src="${member.paymentScreenshot}" 
                             style="max-width: 250px; max-height: 250px; border: 2px solid #ECF0F1; border-radius: 5px; cursor: pointer; object-fit: contain;"
                             onclick="window.open(this.src)"
                             alt="Payment Screenshot">
                        <p style="font-size: 11px; color: #7F8C8D; margin: 5px 0 0 0;">Click image to view full size</p>
                    </div>
                    ` : ''}

                    ${!member.paymentVerified ? `
                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button class="btn" style="background: #27AE60; color: white; padding: 10px 25px;" 
                                onclick="verifyPayment('${member.userId}', true)">
                            ‚úÖ Verify Payment
                        </button>
                        <button class="btn" style="background: #E74C3C; color: white; padding: 10px 25px;" 
                                onclick="verifyPayment('${member.userId}', false)">
                            ‚ùå Reject Payment
                        </button>
                    </div>
                    ` : ''}
                </div>
            `).join('');
        }

        // Search donations
        function searchDonations() {
            const searchTerm = document.getElementById('donationSearch').value.toLowerCase();
            
            const filtered = allDonations.filter(member => 
                member.name.toLowerCase().includes(searchTerm) ||
                member.userId.toLowerCase().includes(searchTerm) ||
                member.mobile.includes(searchTerm) ||
                (member.paymentUTR && member.paymentUTR.toLowerCase().includes(searchTerm))
            );

            displayDonations(filtered);
        }

        // ========== CONTENT MANAGEMENT FUNCTIONS ==========
        let currentContentType = 'certifications';
        let currentEditId = null;

        // Switch content tabs
        function switchContentTab(type) {
            currentContentType = type;
            
            // Update tab buttons
            const contentTabs = document.querySelectorAll('#contentSection .tab-btn');
            contentTabs.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Hide all panels
            document.querySelectorAll('.content-tab-panel').forEach(panel => panel.style.display = 'none');
            
            // Show selected panel
            document.getElementById(type + 'Content').style.display = 'block';
            
            // Load content
            loadContentManagement();
        }

        // Load content management
        function loadContentManagement() {
            switch(currentContentType) {
                case 'certifications':
                    loadCertifications();
                    break;
                case 'team':
                    loadTeam();
                    break;
                case 'gallery':
                    loadGallery();
                    break;
                case 'donors':
                    loadDonorsList();
                    break;
                case 'news':
                    loadNewsList();
                    break;
            }
        }

        // Load Certifications
        function loadCertifications() {
            const certs = ContentManager.Certifications.getAll();
            const container = document.getElementById('certificationsContainer');
            
            if(!certs.length) {
                container.innerHTML = '<div class="empty-state"><div class="icon">üìú</div><h3>No Certifications</h3><p>Add certificates to display them.</p></div>';
                return;
            }
            
            container.innerHTML = certs.map(cert => `
                <div class="member-card">
                    <div class="member-header">
                        <div class="member-info">
                            <div class="member-name">${cert.icon} ${cert.title}</div>
                            <div class="member-id">Issued: ${new Date(cert.issueDate).toLocaleDateString()}</div>
                        </div>
                    </div>
                    <div class="member-details">
                        <div class="detail-item" style="grid-column: 1 / -1;">
                            <span class="detail-label">Description</span>
                            <span class="detail-value">${cert.description}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">PDF URL</span>
                            <span class="detail-value">${cert.pdfUrl}</span>
                        </div>
                    </div>
                    <div class="member-actions">
                        <button class="btn btn-view" onclick="editCertification(${cert.id})">‚úèÔ∏è Edit</button>
                        <button class="btn btn-reject" onclick="deleteCertification(${cert.id})">üóëÔ∏è Delete</button>
                    </div>
                </div>
            `).join('');
        }

        // Load Team
        function loadTeam() {
            const team = ContentManager.Team.getAll();
            const container = document.getElementById('teamContainer');
            
            if(!team.length) {
                container.innerHTML = '<div class="empty-state"><div class="icon">üë•</div><h3>No Team Members</h3><p>Add team members to display them.</p></div>';
                return;
            }
            
            container.innerHTML = team.map(member => `
                <div class="member-card">
                    <div class="member-header">
                        <div style="display: flex; gap: 20px; align-items: center;">
                            <img src="${member.image}" style="width:80px; height:80px; border-radius:50%; object-fit:cover;" alt="${member.name}">
                            <div class="member-info">
                                <div class="member-name">${member.name}</div>
                                <div class="member-id">${member.position}</div>
                            </div>
                        </div>
                    </div>
                    <div class="member-details">
                        <div class="detail-item" style="grid-column: 1 / -1;">
                            <span class="detail-label">Description</span>
                            <span class="detail-value">${member.description}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Phone</span>
                            <span class="detail-value">${member.phone || 'N/A'}</span>
                        </div>
                    </div>
                    <div class="member-actions">
                        <button class="btn btn-view" onclick="editTeamMember(${member.id})">‚úèÔ∏è Edit</button>
                        <button class="btn btn-reject" onclick="deleteTeamMember(${member.id})">üóëÔ∏è Delete</button>
                    </div>
                </div>
            `).join('');
        }

        // Load Gallery
        function loadGallery() {
            const gallery = ContentManager.Gallery.getAll();
            const container = document.getElementById('galleryContainer');
            
            if(!gallery.length) {
                container.innerHTML = '<div class="empty-state"><div class="icon">üñºÔ∏è</div><h3>No Gallery Items</h3><p>Add images to display them.</p></div>';
                return;
            }
            
            container.innerHTML = gallery.map(item => `
                <div class="member-card">
                    <div class="member-header">
                        <div style="display: flex; gap: 20px; align-items: center;">
                            <img src="${item.image}" style="width:100px; height:80px; border-radius:5px; object-fit:cover;" alt="${item.title}">
                            <div class="member-info">
                                <div class="member-name">${item.title}</div>
                                <div class="member-id">${item.category.toUpperCase()} ‚Ä¢ ${new Date(item.date).toLocaleDateString()}</div>
                            </div>
                        </div>
                    </div>
                    <div class="member-details">
                        <div class="detail-item" style="grid-column: 1 / -1;">
                            <span class="detail-label">Description</span>
                            <span class="detail-value">${item.description}</span>
                        </div>
                    </div>
                    <div class="member-actions">
                        <button class="btn btn-view" onclick="editGalleryItem(${item.id})">‚úèÔ∏è Edit</button>
                        <button class="btn btn-reject" onclick="deleteGalleryItem(${item.id})">üóëÔ∏è Delete</button>
                    </div>
                </div>
            `).join('');
        }

        // Load Donors List
        function loadDonorsList() {
            const donors = ContentManager.Donors.getAll();
            const container = document.getElementById('donorsContainer');
            
            if(!donors.length) {
                container.innerHTML = '<div class="empty-state"><div class="icon">üíù</div><h3>No Donors</h3><p>Add donors to display them.</p></div>';
                return;
            }
            
            container.innerHTML = donors.map(donor => `
                <div class="member-card">
                    <div class="member-header">
                        <div class="member-info">
                            <div class="member-name">${donor.name}</div>
                            <div class="member-id">‚Çπ${donor.amount.toLocaleString('en-IN')} ‚Ä¢ ${new Date(donor.date).toLocaleDateString()}</div>
                        </div>
                    </div>
                    <div class="member-details">
                        <div class="detail-item">
                            <span class="detail-label">Type</span>
                            <span class="detail-value">${donor.type}</span>
                        </div>
                        ${donor.message ? `
                        <div class="detail-item" style="grid-column: 1 / -1;">
                            <span class="detail-label">Message</span>
                            <span class="detail-value">${donor.message}</span>
                        </div>
                        ` : ''}
                    </div>
                    <div class="member-actions">
                        <button class="btn btn-view" onclick="editDonor(${donor.id})">‚úèÔ∏è Edit</button>
                        <button class="btn btn-reject" onclick="deleteDonor(${donor.id})">üóëÔ∏è Delete</button>
                    </div>
                </div>
            `).join('');
        }

        // Load News
        function loadNewsList() {
            const news = ContentManager.News.getAll();
            const container = document.getElementById('newsContainer');
            
            if(!news.length) {
                container.innerHTML = '<div class="empty-state"><div class="icon">üì∞</div><h3>No News Posts</h3><p>Add news articles to display them.</p></div>';
                return;
            }
            
            container.innerHTML = news.map(post => `
                <div class="member-card">
                    <div class="member-header">
                        <div class="member-info">
                            <div class="member-name">${post.title}</div>
                            <div class="member-id">${post.category} ‚Ä¢ ${new Date(post.date).toLocaleDateString()}</div>
                        </div>
                    </div>
                    ${post.image ? `<img src="${post.image}" style="width:100%; height:200px; object-fit:cover; border-radius:8px; margin:10px 0;">` : ''}
                    <div class="member-details">
                        <div class="detail-item">
                            <span class="detail-label">Author</span>
                            <span class="detail-value">${post.author}</span>
                        </div>
                        <div class="detail-item" style="grid-column: 1 / -1;">
                            <span class="detail-label">Excerpt</span>
                            <span class="detail-value">${post.excerpt}</span>
                        </div>
                    </div>
                    <div class="member-actions">
                        <button class="btn btn-view" onclick="editNews(${post.id})">‚úèÔ∏è Edit</button>
                        <button class="btn btn-reject" onclick="deleteNews(${post.id})">üóëÔ∏è Delete</button>
                    </div>
                </div>
            `).join('');
        }

        // Modal Functions
        function openCertModal(id = null) {
            currentEditId = id;
            const cert = id ? ContentManager.Certifications.getById(id) : null;
            
            document.getElementById('modalTitle').textContent = id ? 'Edit Certificate' : 'Add Certificate';
            document.getElementById('modalFormContent').innerHTML = `
                <div style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:600;">Icon</label>
                    <input type="text" id="certIcon" class="form-control" value="${cert?.icon || 'üìú'}" placeholder="Emoji icon">
                </div>
                <div style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:600;">Title</label>
                    <input type="text" id="certTitle" class="form-control" value="${cert?.title || ''}" placeholder="Certificate title" required>
                </div>
                <div style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:600;">Description</label>
                    <textarea id="certDescription" class="form-control" rows="3" placeholder="Description" required>${cert?.description || ''}</textarea>
                </div>
                <div style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:600;">PDF URL</label>
                    <input type="text" id="certPdfUrl" class="form-control" value="${cert?.pdfUrl || ''}" placeholder="docs/certificates/filename.pdf" required>
                </div>
                <div style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:600;">Issue Date</label>
                    <input type="date" id="certIssueDate" class="form-control" value="${cert?.issueDate || ''}" required>
                </div>
            `;
            document.getElementById('contentModal').style.display = 'block';
        }

        function openTeamModal(id = null) {
            currentEditId = id;
            const member = id ? ContentManager.Team.getById(id) : null;
            
            document.getElementById('modalTitle').textContent = id ? 'Edit Team Member' : 'Add Team Member';
            document.getElementById('modalFormContent').innerHTML = `
                <div style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:600;">Name</label>
                    <input type="text" id="teamName" class="form-control" value="${member?.name || ''}" placeholder="Full name" required>
                </div>
                <div style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:600;">Position</label>
                    <input type="text" id="teamPosition" class="form-control" value="${member?.position || ''}" placeholder="Job title" required>
                </div>
                <div style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:600;">Description</label>
                    <input type="text" id="teamDescription" class="form-control" value="${member?.description || ''}" placeholder="Brief description" required>
                </div>
                <div style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:600;">Image</label>
                    <input type="file" id="teamImageFile" class="form-control" accept="image/*" ${!id ? 'required' : ''}>
                    ${member?.image ? `<img src="${member.image}" style="width:80px; height:80px; margin-top:10px; border-radius:50%; object-fit:cover;">` : ''}
                    <input type="hidden" id="teamImage" value="${member?.image || ''}">
                </div>
                <div style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:600;">Phone</label>
                    <input type="tel" id="teamPhone" class="form-control" value="${member?.phone || ''}" placeholder="+91XXXXXXXXXX">
                </div>
                <div style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:600;">Facebook</label>
                    <input type="text" id="teamFacebook" class="form-control" value="${member?.facebook || '#'}" placeholder="Facebook URL">
                </div>
                <div style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:600;">Twitter</label>
                    <input type="text" id="teamTwitter" class="form-control" value="${member?.twitter || '#'}" placeholder="Twitter URL">
                </div>
            `;
            
            // Add image upload handler
            document.getElementById('teamImageFile').addEventListener('change', function() {
                ContentManager.handleImageUpload(this, function(dataUrl) {
                    document.getElementById('teamImage').value = dataUrl;
                });
            });
            
            document.getElementById('contentModal').style.display = 'block';
        }

        function openGalleryModal(id = null) {
            currentEditId = id;
            const item = id ? ContentManager.Gallery.getById(id) : null;
            
            document.getElementById('modalTitle').textContent = id ? 'Edit Gallery Item' : 'Add Gallery Item';
            document.getElementById('modalFormContent').innerHTML = `
                <div style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:600;">Title</label>
                    <input type="text" id="galleryTitle" class="form-control" value="${item?.title || ''}" placeholder="Image title" required>
                </div>
                <div style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:600;">Description</label>
                    <textarea id="galleryDescription" class="form-control" rows="2" placeholder="Description" required>${item?.description || ''}</textarea>
                </div>
                <div style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:600;">Image</label>
                    <input type="file" id="galleryImageFile" class="form-control" accept="image/*" ${!id ? 'required' : ''}>
                    ${item?.image ? `<img src="${item.image}" style="width:100px; height:80px; margin-top:10px; border-radius:5px; object-fit:cover;">` : ''}
                    <input type="hidden" id="galleryImage" value="${item?.image || ''}">
                </div>
                <div style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:600;">Category</label>
                    <select id="galleryCategory" class="form-control" required>
                        <option value="events" ${item?.category === 'events' ? 'selected' : ''}>Events</option>
                        <option value="activities" ${item?.category === 'activities' ? 'selected' : ''}>Activities</option>
                    </select>
                </div>
                <div style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:600;">Date</label>
                    <input type="date" id="galleryDate" class="form-control" value="${item?.date || ''}" required>
                </div>
            `;
            
            // Add image upload handler
            document.getElementById('galleryImageFile').addEventListener('change', function() {
                ContentManager.handleImageUpload(this, function(dataUrl) {
                    document.getElementById('galleryImage').value = dataUrl;
                });
            });
            
            document.getElementById('contentModal').style.display = 'block';
        }

        function openDonorModal(id = null) {
            currentEditId = id;
            const donor = id ? ContentManager.Donors.getById(id) : null;
            
            document.getElementById('modalTitle').textContent = id ? 'Edit Donor' : 'Add Donor';
            document.getElementById('modalFormContent').innerHTML = `
                <div style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:600;">Name</label>
                    <input type="text" id="donorName" class="form-control" value="${donor?.name || ''}" placeholder="Donor name" required>
                </div>
                <div style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:600;">Amount (‚Çπ)</label>
                    <input type="number" id="donorAmount" class="form-control" value="${donor?.amount || ''}" placeholder="Amount in rupees" required min="1">
                </div>
                <div style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:600;">Date</label>
                    <input type="date" id="donorDate" class="form-control" value="${donor?.date || ''}" required>
                </div>
                <div style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:600;">Type</label>
                    <select id="donorType" class="form-control" required>
                        <option value="General Fund" ${donor?.type === 'General Fund' ? 'selected' : ''}>General Fund</option>
                        <option value="Education" ${donor?.type === 'Education' ? 'selected' : ''}>Education</option>
                        <option value="Health" ${donor?.type === 'Health' ? 'selected' : ''}>Health</option>
                        <option value="Infrastructure" ${donor?.type === 'Infrastructure' ? 'selected' : ''}>Infrastructure</option>
                        <option value="Other" ${donor?.type === 'Other' ? 'selected' : ''}>Other</option>
                    </select>
                </div>
                <div style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:600;">Message (Optional)</label>
                    <textarea id="donorMessage" class="form-control" rows="2" placeholder="Donor message">${donor?.message || ''}</textarea>
                </div>
            `;
            document.getElementById('contentModal').style.display = 'block';
        }

        function openNewsModal(id = null) {
            currentEditId = id;
            const post = id ? ContentManager.News.getById(id) : null;
            
            document.getElementById('modalTitle').textContent = id ? 'Edit News Post' : 'Add News Post';
            document.getElementById('modalFormContent').innerHTML = `
                <div style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:600;">Title</label>
                    <input type="text" id="newsTitle" class="form-control" value="${post?.title || ''}" placeholder="Post title" required>
                </div>
                <div style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:600;">Excerpt</label>
                    <textarea id="newsExcerpt" class="form-control" rows="2" placeholder="Short summary" required>${post?.excerpt || ''}</textarea>
                </div>
                <div style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:600;">Content</label>
                    <textarea id="newsContent" class="form-control" rows="6" placeholder="Full article content" required>${post?.content || ''}</textarea>
                </div>
                <div style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:600;">Featured Image</label>
                    <input type="file" id="newsImageFile" class="form-control" accept="image/*" ${!id ? 'required' : ''}>
                    ${post?.image ? `<img src="${post.image}" style="width:100px; height:80px; margin-top:10px; border-radius:5px; object-fit:cover;">` : ''}
                    <input type="hidden" id="newsImage" value="${post?.image || ''}">
                </div>
                <div style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:600;">Author</label>
                    <input type="text" id="newsAuthor" class="form-control" value="${post?.author || ''}" placeholder="Author name" required>
                </div>
                <div style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:600;">Category</label>
                    <select id="newsCategory" class="form-control" required>
                        <option value="Community" ${post?.category === 'Community' ? 'selected' : ''}>Community</option>
                        <option value="Events" ${post?.category === 'Events' ? 'selected' : ''}>Events</option>
                        <option value="Education" ${post?.category === 'Education' ? 'selected' : ''}>Education</option>
                        <option value="Health" ${post?.category === 'Health' ? 'selected' : ''}>Health</option>
                        <option value="Announcements" ${post?.category === 'Announcements' ? 'selected' : ''}>Announcements</option>
                    </select>
                </div>
                <div style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:600;">Date</label>
                    <input type="date" id="newsDate" class="form-control" value="${post?.date || ''}" required>
                </div>
            `;
            
            // Add image upload handler
            document.getElementById('newsImageFile').addEventListener('change', function() {
                ContentManager.handleImageUpload(this, function(dataUrl) {
                    document.getElementById('newsImage').value = dataUrl;
                });
            });
            
            document.getElementById('contentModal').style.display = 'block';
        }

        function closeContentModal() {
            document.getElementById('contentModal').style.display = 'none';
            currentEditId = null;
        }

        function submitContentForm(e) {
            e.preventDefault();
            
            let result;
            switch(currentContentType) {
                case 'certifications':
                    const certData = {
                        icon: document.getElementById('certIcon').value,
                        title: document.getElementById('certTitle').value,
                        description: document.getElementById('certDescription').value,
                        pdfUrl: document.getElementById('certPdfUrl').value,
                        issueDate: document.getElementById('certIssueDate').value
                    };
                    result = currentEditId ? 
                        ContentManager.Certifications.update(currentEditId, certData) : 
                        ContentManager.Certifications.create(certData);
                    break;
                    
                case 'team':
                    const teamData = {
                        name: document.getElementById('teamName').value,
                        position: document.getElementById('teamPosition').value,
                        description: document.getElementById('teamDescription').value,
                        image: document.getElementById('teamImage').value,
                        phone: document.getElementById('teamPhone').value,
                        facebook: document.getElementById('teamFacebook').value,
                        twitter: document.getElementById('teamTwitter').value
                    };
                    result = currentEditId ? 
                        ContentManager.Team.update(currentEditId, teamData) : 
                        ContentManager.Team.create(teamData);
                    break;
                    
                case 'gallery':
                    const galleryData = {
                        title: document.getElementById('galleryTitle').value,
                        description: document.getElementById('galleryDescription').value,
                        image: document.getElementById('galleryImage').value,
                        category: document.getElementById('galleryCategory').value,
                        date: document.getElementById('galleryDate').value
                    };
                    result = currentEditId ? 
                        ContentManager.Gallery.update(currentEditId, galleryData) : 
                        ContentManager.Gallery.create(galleryData);
                    break;
                    
                case 'donors':
                    const donorData = {
                        name: document.getElementById('donorName').value,
                        amount: document.getElementById('donorAmount').value,
                        date: document.getElementById('donorDate').value,
                        type: document.getElementById('donorType').value,
                        message: document.getElementById('donorMessage').value
                    };
                    result = currentEditId ? 
                        ContentManager.Donors.update(currentEditId, donorData) : 
                        ContentManager.Donors.create(donorData);
                    break;
                    
                case 'news':
                    const newsData = {
                        title: document.getElementById('newsTitle').value,
                        excerpt: document.getElementById('newsExcerpt').value,
                        content: document.getElementById('newsContent').value,
                        image: document.getElementById('newsImage').value,
                        author: document.getElementById('newsAuthor').value,
                        category: document.getElementById('newsCategory').value,
                        date: document.getElementById('newsDate').value
                    };
                    result = currentEditId ? 
                        ContentManager.News.update(currentEditId, newsData) : 
                        ContentManager.News.create(newsData);
                    break;
            }
            
            if(result.success) {
                showAlert('success', `‚úÖ ${currentContentType.charAt(0).toUpperCase() + currentContentType.slice(1)} ${currentEditId ? 'updated' : 'created'} successfully!`);
                closeContentModal();
                loadContentManagement();
            } else {
                showAlert('error', '‚ùå ' + result.error);
            }
        }

        // Edit functions
        function editCertification(id) { openCertModal(id); }
        function editTeamMember(id) { openTeamModal(id); }
        function editGalleryItem(id) { openGalleryModal(id); }
        function editDonor(id) { openDonorModal(id); }
        function editNews(id) { openNewsModal(id); }

        // Delete functions
        function deleteCertification(id) {
            if(confirm('Are you sure you want to delete this certificate?')) {
                ContentManager.Certifications.delete(id);
                showAlert('success', '‚úÖ Certificate deleted successfully!');
                loadCertifications();
            }
        }

        function deleteTeamMember(id) {
            if(confirm('Are you sure you want to delete this team member?')) {
                ContentManager.Team.delete(id);
                showAlert('success', '‚úÖ Team member deleted successfully!');
                loadTeam();
            }
        }

        function deleteGalleryItem(id) {
            if(confirm('Are you sure you want to delete this gallery item?')) {
                ContentManager.Gallery.delete(id);
                showAlert('success', '‚úÖ Gallery item deleted successfully!');
                loadGallery();
            }
        }

        function deleteDonor(id) {
            if(confirm('Are you sure you want to delete this donor?')) {
                ContentManager.Donors.delete(id);
                showAlert('success', '‚úÖ Donor deleted successfully!');
                loadDonorsList();
            }
        }

        function deleteNews(id) {
            if(confirm('Are you sure you want to delete this news post?')) {
                ContentManager.News.delete(id);
                showAlert('success', '‚úÖ News post deleted successfully!');
                loadNewsList();
            }
        }

        // Initialize on page load
        init();
    </script>
</body>
</html>
